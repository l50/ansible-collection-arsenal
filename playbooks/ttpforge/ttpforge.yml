---
- name: TTPForge
  hosts: all
  vars:
    ttpforge_global_install: true
    asdf_dir: /opt/asdf
  roles:
    - name: Create ttpforge role user (if not already present)
      role: cowdogmoo.workstation.user_setup
      vars:
        user_setup_default_users: "{{ ttpforge_users }}"

    - name: Install asdf and go
      role: cowdogmoo.workstation.asdf
      vars:
        asdf_global_install: "{{ ttpforge_global_install | default(false) }}"

    - name: Create TTPForge users
      become: true
      role: cowdogmoo.workstation.user_setup

    - name: Install TTPForge
      become: true # Required to install TTPForge system-wide
      role: l50.arsenal.ttpforge
      environment:
        ASDF_DATA_DIR: /opt/asdf
        ASDF_DIR: /opt/asdf
      vars:
        ttpforge_go_path: /opt/asdf/shims/go
        ttpforge_install_path: /usr/local/bin/ttpforge
        ttpforge_repo_path: /opt/ttpforge
        ttpforge_global_install: true
