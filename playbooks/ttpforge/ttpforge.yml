---
- name: TTPForge
  hosts: all
  vars:
    ttpforge_users:
      # Install and configure TTPForge for the current user
      - username: "{{ ansible_user_id }}"
        usergroup: "{{ ansible_user_id }}"
        shell: "{{ ansible_env.SHELL | default('/bin/bash') }}"
        sudo: true
        plugins:
          - name: golang
            version: "1.22.0"
            scope: "global"

  tasks:
    - name: Include default variables
      ansible.builtin.include_vars:
        file: "../../defaults/main.yml"

    - name: Include variables
      ansible.builtin.include_vars:
        file: "../../vars/main.yml"

  roles:
    - name: Install asdf and go
      role: cowdogmoo.workstation.asdf
      vars:
        asdf_global_install: true
        asdf_users: ["{{ ttpforge_users }}"]
    - role: l50.arsenal.ttpforge
