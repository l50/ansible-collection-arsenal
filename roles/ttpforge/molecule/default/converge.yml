---
- name: Converge
  hosts: all
  tasks:
    - name: Include default variables
      ansible.builtin.include_vars:
        file: "../../defaults/main.yml"
    - name: Include variables
      ansible.builtin.include_vars:
        file: "../../vars/main.yml"

  roles:
    - name: Create ttpforge role user (if not already present)
      role: cowdogmoo.workstation.user_setup
      vars:
        user_setup_default_users: "{{ ttpforge_users }}"

    - name: Install asdf and go
      role: cowdogmoo.workstation.asdf

    - name: Run the ttpforge role
      role: "{{ lookup('env', 'MOLECULE_PROJECT_DIRECTORY') | basename }}"
